<html>
<head>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/2.3.0/shaka-player.compiled.js"></script>
  <script src="https://shaka-player-demo.appspot.com/node_modules/mux.js/dist/mux.js"></script>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/pushy/1.0.0/css/pushy.css">
</head>

<body style="margin:0; overflow:hidden; background-color:#000">
<nav class="pushy pushy-left">
    <ul>
    </ul>
</nav>
<div class="site-overlay"></div>

<div id="container">
    <div class="menu-btn">&#9776; Channels</div>
    <video controls id="video" style="width:100%; height:100%"></video>
</div>

<script>
shaka.polyfill.installAll();

var video = document.getElementById('video');
var proxy;
var player;

function cast() {
   proxy.isCasting() ? proxy.suggestDisconnect() : proxy.cast()
};

function set_channel(c) {
  if(proxy) proxy.destroy();
  player = new shaka.Player(video);
  proxy = new shaka.cast.CastProxy(video, player, "A15A181D");
  proxy.getPlayer().load(c).then(function() {
    video.play()
  }).catch(function(e) {
    console.log(e)
  });
}

if (shaka.Player.isBrowserSupported()) {
  $.get("/channels.json",function(sources) {
    $.each(sources, function(k,source) {
      var sublist = $('<li><span>' + k + '</span><ul></ul></li>');
      $.each(source, function(cname,curl) {
        var cbtn = $('<li class="pushy-link"><a href="#">' + cname + '</a></li>');
        cbtn.click(function() {
          set_channel(curl);
        });
        $(sublist.find('ul')).append(cbtn);
      });
      $(".pushy > ul").append(sublist);
    });
    $(".pushy-link").first().click();
    var script = document.createElement( 'script' );
    script.type = 'text/javascript';
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pushy/1.0.0/js/pushy.min.js';
    $("body").append(script);
  });
}
</script>


<style>
.menu-btn{
  width: 100px;
  padding: 10px;
  margin-bottom: 30px;
  background: #000;
  color: #FFF;
  text-align: center;
  cursor: pointer;
  position:fixed;
  z-index:99;
}
.menu-btn:hover{
background: #00b4ff;
}
.pushy ul {
 list-style-type: none;
 padding: 10px;
}
.pushy {
  color: #FFF;
}
</style>

</body>
</html>
